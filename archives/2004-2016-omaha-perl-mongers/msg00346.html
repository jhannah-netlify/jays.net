<!-- MHonArc v2.6.24 -->
<!--X-Subject: RE: [Omaha.pm] IIS server log analysis -->
<!--X-From-R13: "Frtryf, Yrag" &#60;Yrag.FrtryfNuqevap.pbz> -->
<!--X-Date: 23 Mar 2005 04:26:05 &#45;0000 -->
<!--X-Message-Id: 8046479841F5F84C9BD1F5CF4AD4379E01E73E46@OMA&#45;G&#45;L.intranet.hdr -->
<!--X-Content-Type: multipart/alternative -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>RE: [Omaha.pm] IIS server log analysis</title>
<link rev="made" href="mailto:Kent.Tegels@hdrinc.com">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<hr>
[<a href="msg00345.html">Date Prev</a>][<a href="msg00347.html">Date Next</a>][<a href="msg00345.html">Thread Prev</a>][<a href="msg00347.html">Thread Next</a>][<a href="maillist.html#00346">Date Index</a>][<a href="threads.html#00346">Thread Index</a>]
<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>RE: [Omaha.pm] IIS server log analysis</h1>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>To</em>: &quot;Perl Mongers of Omaha, Nebraska USA&quot; &lt;<a href="mailto:omaha-pm%40pm.org">omaha-pm@pm.org</a>&gt;,	&quot;Omaha Perl Mongers&quot; &lt;<a href="mailto:omaha-pm%40pm.org">omaha-pm@pm.org</a>&gt;</li>
<li><em>Subject</em>: RE: [Omaha.pm] IIS server log analysis</li>
<li><em>From</em>: &quot;Tegels, Kent&quot; &lt;<a href="mailto:Kent.Tegels%40hdrinc.com">Kent.Tegels@hdrinc.com</a>&gt;</li>
<li><em>Date</em>: Tue, 22 Mar 2005 22:25:38 -0600</li>
<li><em>Delivered-to</em>: <a href="mailto:mailman-omaha-pm%40mailman.pm.dev">mailman-omaha-pm@mailman.pm.dev</a></li>
<li><em>Delivered-to</em>: <a href="mailto:omaha-pm%40pm.org">omaha-pm@pm.org</a></li>
<li><em>List-archive</em>: &lt;<a href="http://mail.pm.org/pipermail/omaha-pm">http://mail.pm.org/pipermail/omaha-pm</a>&gt;</li>
<li><em>List-help</em>: &lt;<a href="mailto:omaha-pm-request@pm.org?subject=help">mailto:omaha-pm-request@pm.org?subject=help</a>&gt;</li>
<li><em>List-id</em>: &quot;Perl Mongers of Omaha, Nebraska USA&quot; &lt;omaha-pm.pm.org&gt;</li>
<li><em>List-post</em>: &lt;<a href="mailto:omaha-pm@pm.org">mailto:omaha-pm@pm.org</a>&gt;</li>
<li><em>List-subscribe</em>: &lt;<a href="http://mail.pm.org/mailman/listinfo/omaha-pm">http://mail.pm.org/mailman/listinfo/omaha-pm</a>&gt;,	&lt;<a href="mailto:omaha-pm-request@pm.org?subject=subscribe">mailto:omaha-pm-request@pm.org?subject=subscribe</a>&gt;</li>
<li><em>List-unsubscribe</em>: &lt;<a href="http://mail.pm.org/mailman/listinfo/omaha-pm">http://mail.pm.org/mailman/listinfo/omaha-pm</a>&gt;,	&lt;<a href="mailto:omaha-pm-request@pm.org?subject=unsubscribe">mailto:omaha-pm-request@pm.org?subject=unsubscribe</a>&gt;</li>
<li><em>Reply-to</em>: &quot;Perl Mongers of Omaha, Nebraska USA&quot; &lt;<a href="mailto:omaha-pm%40pm.org">omaha-pm@pm.org</a>&gt;</li>
<li><em>Thread-index</em>: AcUvWkDYzqSY9+J3QniCfOgeztbJHgABhz9I</li>
<li><em>Thread-topic</em>: [Omaha.pm] IIS server log analysis</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<address>Title: <strong>[Omaha.pm] IIS server log analysis</strong></address>





<DIV id=idOWAReplyText28443 dir=ltr>
<DIV dir=ltr><FONT face=Arial color=#000000 size=2><A rel="nofollow" 
href="http://sqljunkies.com/WebLog/ktegels/archive/2003/12/05/580.aspx">http://sqljunkies.com/WebLog/ktegels/archive/2003/12/05/580.aspx</A></FONT></DIV></DIV>
<DIV dir=ltr><BR>
<HR tabIndex=-1>
<FONT face=Tahoma size=2><B>From:</B> omaha-pm-bounces@pm.org on behalf of Jay 
Hannah<BR><B>Sent:</B> Tue 3/22/2005 7:26 PM<BR><B>To:</B> Omaha Perl 
Mongers<BR><B>Subject:</B> [Omaha.pm] IIS server log 
analysis<BR></FONT><BR></DIV>
<DIV>
<P><FONT size=2>&nbsp;From the Why Didn't I Post This Yesterday To Let Someone 
Else Do My&nbsp;<BR>Homework For Me 
Department<BR><BR>-----------------<BR>PROBLEM<BR>-----------------<BR><BR>Given 
a directory of .zip 
files:<BR><BR>ex050220.zip<BR>ex050221.zip<BR>ex050222.zip<BR>ex050223.zip<BR>ex050224.zip<BR>ex050225.zip<BR>ex050226.zip<BR><BR>Containing 
IIS server logs like this:<BR><BR># Fields: date time c-ip cs-username s-ip 
s-port cs-method cs-uri-stem&nbsp;<BR>cs-uri-query sc-status sc-bytes 
cs(User-Agent) cs(Cookie) cs(Referer)<BR>2005-02-20 00:00:00 68.60.191.239 - 
198.64.145.249 443 GET&nbsp;<BR>/images/header/tnd_sg_07-over.gif - 304 
163&nbsp;<BR>Mozilla/4.0+(compatible;+MSIE+6.0;+Windows+NT+5.1)&nbsp;<BR>ASPSESSIONIDSCSSSCRD=OAMAHBPAJHHBGEJEKBALFCOO&nbsp;<BR><A rel="nofollow" 
href="https://ssl.omnihotels.com/Omni">https://ssl.omnihotels.com/Omni</A>?<BR>prop=CHIDTN&amp;pagedst=AvailReq&amp;pagesrc=Hotels<BR>...<BR><BR>Report 
the total number of bytes per hour transferred from port 80 and&nbsp;<BR>port 
443 like so:<BR><BR>Year to hour&nbsp; Port 80&nbsp;&nbsp; Port 
443<BR>------------- --------- -----------<BR>2005-02-20-00 208867846 
31587703<BR>2005-02-20-01 193477261 25950887<BR>2005-02-20-02 210614224 
24952027<BR>...<BR><BR>-----------------<BR>SOLUTION<BR>-----------------<BR><BR>for 
(20 .. 26) {<BR>&nbsp;&nbsp;&nbsp; # Shooting for: 
ex050220.log<BR>&nbsp;&nbsp;&nbsp; $file = sprintf("ex0502%d", 
$_);<BR>&nbsp;&nbsp;&nbsp; `unzip $file.zip`;<BR>&nbsp;&nbsp;&nbsp; 
readfile("$file.log");<BR>&nbsp;&nbsp;&nbsp; 
unlink("$file.log");<BR>}<BR><BR>sub readfile {<BR>&nbsp;&nbsp;&nbsp; my ($file) 
= @_;<BR>&nbsp;&nbsp;&nbsp; my %stats;<BR>&nbsp;&nbsp;&nbsp; open (IN, 
$file);<BR>&nbsp;&nbsp;&nbsp; while (&lt;IN&gt;) 
{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; next if 
/^#/;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; my @l = split / 
/;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $hour = 
$l[1];<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $hour =~ 
s/:.*//;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $stats{"$l[0]-$hour"}{$l[5]} += 
$l[10];<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
#$cnt++;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #last if ($cnt == 
500);<BR>&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp; close 
IN;<BR><BR>&nbsp;&nbsp;&nbsp; foreach (sort keys %stats) 
{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print "$_ $stats{$_}{80} 
$stats{$_}{443}\n";<BR>&nbsp;&nbsp;&nbsp; 
}<BR>}<BR><BR><BR>_______________________________________________<BR>Omaha-pm 
mailing list<BR>Omaha-pm@pm.org<BR><A rel="nofollow" 
href="http://mail.pm.org/mailman/listinfo/omaha-pm">http://mail.pm.org/mailman/listinfo/omaha-pm</A><BR></FONT></P></DIV>



<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00347" href="msg00347.html">Re: [Omaha.pm] IIS server log analysis</a></strong>
<ul><li><em>From:</em> Jay Hannah &lt;jay@jays.net&gt;</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg00345.html">[Omaha.pm] IIS server log analysis</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg00347.html">Re: [Omaha.pm] IIS server log analysis</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg00345.html">[Omaha.pm] IIS server log analysis</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00347.html">Re: [Omaha.pm] IIS server log analysis</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#00346"><strong>Date</strong></a></li>
<li><a href="threads.html#00346"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
</body>
</html>
