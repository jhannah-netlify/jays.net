<!-- MHonArc v2.6.24 -->
<!--X-Subject: Re: [Omaha.pm] Mapping Perl structures to a SQL table... -->
<!--X-From-R13: Fbqq Quevfgbcure Vnzvygba &#60;argneggbqqNtznvy.pbz> -->
<!--X-Date: 30 Oct 2009 22:24:14 &#45;0000 -->
<!--X-Message-Id: 4AEB6784.3030904@Gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 3e2be50910301131h5803fe21j5843873d37f9bd27@mail.gmail.com -->
<!--X-Reference: a4439dea0910301406p2f5b0785lc6f9a68f59a3148d@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: [Omaha.pm] Mapping Perl structures to a SQL table...</title>
<link rev="made" href="mailto:netarttodd@gmail.com">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<hr>
[<a href="msg02237.html">Date Prev</a>][<a href="msg02239.html">Date Next</a>][<a href="msg02237.html">Thread Prev</a>][<a href="msg02239.html">Thread Next</a>][<a href="maillist.html#02238">Date Index</a>][<a href="threads.html#02238">Thread Index</a>]
<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: [Omaha.pm] Mapping Perl structures to a SQL table...</h1>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>To</em>: &quot;Perl Mongers of Omaha, Nebraska USA&quot; &lt;<a href="mailto:omaha-pm%40pm.org">omaha-pm@pm.org</a>&gt;</li>
<li><em>Subject</em>: Re: [Omaha.pm] Mapping Perl structures to a SQL table...</li>
<li><em>From</em>: Todd Christopher Hamilton &lt;<a href="mailto:netarttodd%40gmail.com">netarttodd@gmail.com</a>&gt;</li>
<li><em>Date</em>: Fri, 30 Oct 2009 17:24:04 -0500</li>
<li><em>Cc</em>: Omaha Linux User Group &lt;<a href="mailto:olug%40olug.org">olug@olug.org</a>&gt;</li>
<li><em>Delivered-to</em>: <a href="mailto:mailman-omaha-pm%40mailman.pm.dev">mailman-omaha-pm@mailman.pm.dev</a></li>
<li><em>Delivered-to</em>: <a href="mailto:omaha-pm%40pm.org">omaha-pm@pm.org</a></li>
<li><em>Dkim-signature</em>: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=gamma;	h=domainkey-signature:received:received:message-id:date:from	:user-agent:mime-version:to:cc:subject:references:in-reply-to	:content-type:content-transfer-encoding;	bh=CXgHRFWoHCmzZRC3vFQAaImZHLEUN3zJDskmy3cwPwg=;	b=lk2ZPaB3hSdk1GPxi2wTw54TfcobTcDECqnnIhieYEJmp+zASwz/mS1lzvFafvEgjg	AEQkZF2Grb3E8Iom8wa5qJ77KpJnQXBbZh38MiM2cVvOn7FWaIYZRpbnwUr0GxWSdjyy	7FJvlXDWtM1fmB703zHtte15h1wFt/Rm089H0=</li>
<li><em>Domainkey-signature</em>: a=rsa-sha1; c=nofws; d=gmail.com; s=gamma;	h=message-id:date:from:user-agent:mime-version:to:cc:subject	:references:in-reply-to:content-type:content-transfer-encoding;	b=sG5bjQcOVcV6098R5P1MloBNudK3D3FuI8OksExXAB6DRBrHUD4UFySbLHKqP7wQ+x	giTkTPe1JrcAyBSVU6xzWI03iikFirKUXJCnC3g3YrdfS0lwhPusiaM1CM+wlw1gSv1x	V1qVLUoFefQJNEXXLZ6TmyGOQn5KQuDIdE3aQ=</li>
<li><em>In-reply-to</em>: &lt;<a href="msg02237.html">a4439dea0910301406p2f5b0785lc6f9a68f59a3148d@mail.gmail.com</a>&gt;</li>
<li><em>List-archive</em>: &lt;<a href="http://mail.pm.org/pipermail/omaha-pm">http://mail.pm.org/pipermail/omaha-pm</a>&gt;</li>
<li><em>List-help</em>: &lt;<a href="mailto:omaha-pm-request@pm.org?subject=help">mailto:omaha-pm-request@pm.org?subject=help</a>&gt;</li>
<li><em>List-id</em>: &quot;Perl Mongers of Omaha, Nebraska USA&quot; &lt;omaha-pm.pm.org&gt;</li>
<li><em>List-post</em>: &lt;<a href="mailto:omaha-pm@pm.org">mailto:omaha-pm@pm.org</a>&gt;</li>
<li><em>List-subscribe</em>: &lt;<a href="http://mail.pm.org/mailman/listinfo/omaha-pm">http://mail.pm.org/mailman/listinfo/omaha-pm</a>&gt;,	&lt;<a href="mailto:omaha-pm-request@pm.org?subject=subscribe">mailto:omaha-pm-request@pm.org?subject=subscribe</a>&gt;</li>
<li><em>List-unsubscribe</em>: &lt;<a href="http://mail.pm.org/mailman/options/omaha-pm">http://mail.pm.org/mailman/options/omaha-pm</a>&gt;,	&lt;<a href="mailto:omaha-pm-request@pm.org?subject=unsubscribe">mailto:omaha-pm-request@pm.org?subject=unsubscribe</a>&gt;</li>
<li><em>References</em>: &lt;<a href="msg02235.html">3e2be50910301131h5803fe21j5843873d37f9bd27@mail.gmail.com</a>&gt;	&lt;<a href="msg02237.html">a4439dea0910301406p2f5b0785lc6f9a68f59a3148d@mail.gmail.com</a>&gt;</li>
<li><em>Reply-to</em>: &quot;Perl Mongers of Omaha, Nebraska USA&quot; &lt;<a href="mailto:omaha-pm%40pm.org">omaha-pm@pm.org</a>&gt;</li>
<li><em>User-agent</em>: Thunderbird 2.0.0.21 (Windows/20090302)</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">
Here are some thought:

</pre><tt>I have found that when designing a database one needs to be at peace 
</tt><tt>with the flexibility / performance balance.  (Come to think of it isn't 
</tt><tt>that why we use Perl?  You can write faster code with C but you can 
</tt><tt>write code faster with Perl)
</tt><pre style="margin: 0em;">

</pre><tt>If you want high flexibility you might use a Entity-Attribute-Value 
</tt><tt>model.  But eventually you come to the point where performance 
</tt><tt>requirements force you to think in more ridged terms.  You will then 
</tt><tt>apply performance based design principles within the context of the 
</tt><tt>information domain.
</tt><pre style="margin: 0em;">

</pre><tt>Since you are converting a file system database to a DBMS structure, you 
</tt><tt>already have some structure you can exploit. Files, Directories (which 
</tt><tt>are files), file attributes (fixed number of attributes and values). 
</tt><tt>The real flexibility comes when you need to store the contents of the 
</tt><tt>file. But then again how much performance do you need/  Your performance 
</tt><tt>comes in when you are trying find and map the structure. Once you find 
</tt><tt>the file base on the attributes you then will display it.
</tt><pre style="margin: 0em;">

I would start with three tables:
1. Files
2. FileAttributes
2. FileContent

Files would have the following columns
  1. Id
  2. ParentId ( the id of the directory this file is in )
  3. Name
</pre><tt>  4...  All your permission attributes like user read permissions, 
</tt><tt>group   permission
</tt><pre style="margin: 0em;">
  5... All you file attributes like creation date time, mod date time, size

</pre><tt>Then you second table would contain non indexed attributes of the file 
</tt><tt>or directory. Category, Subject, Author, status
</tt><pre style="margin: 0em;">

Then your third table would be the actual file contents.

</pre><tt>You would then use the DBMS to provide performance structure (indexes, 
</tt><tt>constraints, aggregation, transactions, journaling)
</tt><pre style="margin: 0em;">








Mario Steele wrote:
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
Heya Dan,

</pre><tt>It would help to have a bit of information about the general structure 
</tt><tt>you are currently using, before giving any ideas about storing the data 
</tt><tt>in a SQL Database.  Obviously your doing Directories and Files, but the 
</tt><tt>structure helps in determining the way to make things work in the SQL 
</tt><tt>Database.  Poor design of the SQL Database, will lead to poor execution 
</tt><tt>of SQL instructions, as much more is required to get the data you want.
</tt><pre style="margin: 0em;">

</pre><tt>To give you some idea of how I would convert a file system database into 
</tt><tt>a SQL Database, I'll give you an example of a file structure database, 
</tt><tt>and a description of what entry means, then show the resulting database 
</tt><tt>structure for SQL.
</tt><pre style="margin: 0em;">
An example, of a simple design using Folders:

db/
  cust_records/
    cust1_info.dat
    cust1_purchase.dat
    cust2_info.dat
    cust2_purchase.dat
  inventory/
    item1_info.dat
    item2_info.dat

</pre><tt>cust#_info.dat contains:  Customer Name, Address, Phone Number, Shipping 
</tt><tt>Info, and such.
</tt><tt>cust#_purchase.dat contains: Customer's a record of all the purchases 
</tt><tt>that a customer has made.
</tt><pre style="margin: 0em;">

</pre><tt>item#_info.dat contains: Name of Item, Description, Price, Quantity, 
</tt><tt>Shipping price, Shipping Weight.
</tt><pre style="margin: 0em;">

Now, to convert this into a SQL Database, I would formulate it as such:

db
  customers
    id                   - INTEGER, PRIMARY KEY, AUTOINCREMENT
    name                 - STRING
    address              - STRING
    phone                - STRING
    ship_to              - STRING
  transactions
    id                   - INTEGER, PRIMARY KEY, AUTOINCREMENT
    cust_id              - INTEGER, PRIMARY KEY
    item_id              - INTEGER
    quantity             - INTEGER
    purchased_date       - INTEGER
  inventory
    id                   - INTEGER, PRIMARY KEY, AUTOINCREMENT
    item_name            - STRING
    description          - STRING
    price                - STRING
    total_per_quantity   - INTEGER
    ship_price           - INTEGER
    ship_weight          - INTEGER

</pre><tt>Now some explaining about what the right hand side is all about in the 
</tt><tt>above layout. The first field in all tables are 'id', which is marked as 
</tt><tt>INTEGER, PRIMARY KEY, AUTOINCREMENT.  Integer denotes a number, of 
</tt><tt>course, Primary Key tells the SQL engine to make quick look ups based 
</tt><tt>upon this field being one of the more often checked fields to look up 
</tt><tt>records in a database.  Finally the Auto increment (Which is one word in 
</tt><tt>SQL), denotes the fact that each new record put into the SQL database, 
</tt><tt>should take the total number of rows, and add one to that number, to 
</tt><tt>assign the identification number for this record.   And lastly, a String 
</tt><tt>is a variable length of text data to be stored.  Most SQL engines will 
</tt><tt>allow for 5 or 6 paragraphs worth of text, but this can be expensive in 
</tt><tt>storage and retrieval.  If you know that a field is only going to be so 
</tt><tt>many characters, such as Phone, maximum being 13 characters, then you 
</tt><tt>can use VARCHAR(13) as the maximum length of the data that is going to 
</tt><tt>be stored in that field.
</tt><pre style="margin: 0em;">

</pre><tt>There's also FLOAT, which allows for decimal points, but Integers in 
</tt><tt>most SQL Engines will take decimal numbers, and keep the decimals.  But 
</tt><tt>it's always best to see what data types a SQL engine supports, before 
</tt><tt>making a final decision.  Most DBI's will automatically provide a way to 
</tt><tt>store common data types in the database, at their best formulation to 
</tt><tt>save as much space for the database engine to handle.  So look at Perl's 
</tt><tt>DBI for Constructing Tables to see what assistance it will bring you.  
</tt><tt>Lastly, one other data type I didn't cover in the above database, is the 
</tt><tt>BLOB data type.  BLOB data types are for storing Binary data in, should 
</tt><tt>you find the need to store some binary data in the database.
</tt><pre style="margin: 0em;">

</pre><tt>With blobs, there are no conversions done to store the data in the 
</tt><tt>database, it's stored as is (As in, as you provide it to the SQL 
</tt><tt>Database), and can contain any valid byte sequence in it.  Meaning, 
</tt><tt>anything between 0 and 255 can be stored here.  Most SQL Engines will 
</tt><tt>store UTF-8/16 characters in strings without stripping them, but when in 
</tt><tt>doubt, you can use the Blob data type.
</tt><pre style="margin: 0em;">

</pre><tt>Now, with the explanations of the data types out of the way, the 
</tt><tt>structure is efficiently designed, for the simple fact, that if you have 
</tt><tt>the ID of the customer, you can get all the items that they purchased, 
</tt><tt>and get each items information from the id's that you get from the 
</tt><tt>transaction table.  You can even use the SQL Instruction JOIN to get all 
</tt><tt>the data you need in a single execute, for example, if you wanted to get 
</tt><tt>the name of the person, the name of the item, and the total cost, you 
</tt><tt>could simply do:
</tt><pre style="margin: 0em;">

SELECT name, item_name, price
FROM transactions
JOIN customers
  ON customers.id &lt;<a  rel="nofollow" href="http://customers.id">http://customers.id</a>&gt; = transactions.cust_id
JOIN inventory
  ON inventory.id &lt;<a  rel="nofollow" href="http://inventory.id">http://inventory.id</a>&gt; = transactions.item_id;

This will return a list of all transactions in the format of:
name | item_name | price

Examples being:

&quot;John Doe&quot;,&quot;ASUS PC&quot;,299.99
&quot;Mary Johnson&quot;, &quot;Microsoft Mouse&quot;, 19.99
etc, etc.

</pre><tt>It makes cross-table look ups a lot easier, to get the relevant data for 
</tt><tt>what you need, and only what you need.  And all of it is handled by the 
</tt><tt>SQL Engine, not Perl, or whatever high level language you use, so the 
</tt><tt>execution speed is greatly improved.
</tt><pre style="margin: 0em;">

HTH,

Mario


</pre><tt>On Fri, Oct 30, 2009 at 1:31 PM, Dan Linder &lt;dan@linder.org 
</tt><tt>&lt;<a  rel="nofollow" href="mailto:dan@linder.org">mailto:dan@linder.org</a>&gt;&gt; wrote:
</tt><pre style="margin: 0em;">

    I'm taking on the task of converting our in-house tool to use the Perl
    DBI module to replace the Data::Dumper/eval() it currently uses to
    store and retrieve data.  Not pretty, but it has worked pretty well
    for the small data sets we've been using.

    We now have some people commenting on the speed - some have pages take
    7+ minutes to bring up waiting for the back-end perl code to ripple
    through the directory structure and eval() the necessary files to
    build the page.  The &quot;eval&quot; function seems to be the bulk of the time
    as I expected...

    What I'm looking for is some general comments and discussion about the
    mental task of mapping these hash tables into a SQL table.  I'm not
    really looking for a tool, more a high level discussion about ways to
    store the data and still remain flexible.

    Dan

    --
    ******************* ***************** ************* ***********
    ******* ***** *** **
    &quot;Quis custodiet ipsos custodes?&quot; (Who can watch the watchmen?) -- from
    the Satires of Juvenal
    &quot;I do not fear computers, I fear the lack of them.&quot; -- Isaac Asimov
    (Author)
    ** *** ***** ******* *********** ************* *****************
    *******************
    _______________________________________________
    Omaha-pm mailing list
    Omaha-pm@pm.org &lt;<a  rel="nofollow" href="mailto:Omaha-pm@pm.org">mailto:Omaha-pm@pm.org</a>&gt;
    <a  rel="nofollow" href="http://mail.pm.org/mailman/listinfo/omaha-pm">http://mail.pm.org/mailman/listinfo/omaha-pm</a>




--
Mario Steele
<a  rel="nofollow" href="http://www.trilake.net">http://www.trilake.net</a>
<a  rel="nofollow" href="http://www.ruby-im.net">http://www.ruby-im.net</a>
<a  rel="nofollow" href="http://rubyforge.org/projects/wxruby/">http://rubyforge.org/projects/wxruby/</a>
<a  rel="nofollow" href="http://rubyforge.org/projects/wxride/">http://rubyforge.org/projects/wxride/</a>


------------------------------------------------------------------------

_______________________________________________
Omaha-pm mailing list
Omaha-pm@pm.org
<a  rel="nofollow" href="http://mail.pm.org/mailman/listinfo/omaha-pm">http://mail.pm.org/mailman/listinfo/omaha-pm</a>
</pre></blockquote><pre style="margin: 0em;">

</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="02235" href="msg02235.html">[Omaha.pm] Mapping Perl structures to a SQL table...</a></strong>
<ul><li><em>From:</em> Dan Linder &lt;dan@linder.org&gt;</li></ul></li>
<li><strong><a name="02237" href="msg02237.html">Re: [Omaha.pm] Mapping Perl structures to a SQL table...</a></strong>
<ul><li><em>From:</em> Mario Steele &lt;mario@ruby-im.net&gt;</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg02237.html">Re: [Omaha.pm] Mapping Perl structures to a SQL table...</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg02239.html">Re: [Omaha.pm] Mapping Perl structures to a SQL table...</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg02237.html">Re: [Omaha.pm] Mapping Perl structures to a SQL table...</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg02239.html">Re: [Omaha.pm] Mapping Perl structures to a SQL table...</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#02238"><strong>Date</strong></a></li>
<li><a href="threads.html#02238"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
</body>
</html>
