<!-- MHonArc v2.6.24 -->
<!--X-Subject: [Omaha.pm] Fwd:  Perl and recursion... -->
<!--X-From-R13: Furbqber Yngfrerf &#60;grqxngNtznvy.pbz> -->
<!--X-Date: 15 Nov 2005 22:20:53 &#45;0000 -->
<!--X-Message-Id: b037451c0511151420g7cb68ed1k9f304aa4f95b1e07@mail.gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 2379.68.13.86.85.1132076062.squirrel@mail.linder.org -->
<!--X-Reference: b037451c0511151131q2679fb4x14946ab01dad22ff@mail.gmail.com -->
<!--X-Reference: 2384.68.13.86.85.1132083886.squirrel@mail.linder.org -->
<!--X-Reference: b037451c0511151254q56fbddd1g758cebf6e5083058@mail.gmail.com -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>[Omaha.pm] Fwd:  Perl and recursion...</title>
<link rev="made" href="mailto:tedkat@gmail.com">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<hr>
[<a href="msg00656.html">Date Prev</a>][<a href="msg00658.html">Date Next</a>][<a href="msg00656.html">Thread Prev</a>][<a href="msg00658.html">Thread Next</a>][<a href="maillist.html#00657">Date Index</a>][<a href="threads.html#00657">Thread Index</a>]
<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>[Omaha.pm] Fwd:  Perl and recursion...</h1>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>To</em>: &quot;Perl Mongers of Omaha, Nebraska USA&quot; &lt;<a href="mailto:omaha-pm%40pm.org">omaha-pm@pm.org</a>&gt;</li>
<li><em>Subject</em>: [Omaha.pm] Fwd:  Perl and recursion...</li>
<li><em>From</em>: Theodore Katseres &lt;<a href="mailto:tedkat%40gmail.com">tedkat@gmail.com</a>&gt;</li>
<li><em>Date</em>: Tue, 15 Nov 2005 16:20:40 -0600</li>
<li><em>Delivered-to</em>: <a href="mailto:mailman-omaha-pm%40mailman.pm.dev">mailman-omaha-pm@mailman.pm.dev</a></li>
<li><em>Delivered-to</em>: <a href="mailto:omaha-pm%40pm.org">omaha-pm@pm.org</a></li>
<li><em>Domainkey-signature</em>: a=rsa-sha1; q=dns; c=nofws; s=beta; d=gmail.com;	h=received:message-id:date:from:to:subject:in-reply-to:mime-version:content-type:content-transfer-encoding:content-disposition:references;	b=fh8iw3vBjWnEG3DSxtqgyD20tHreflgXONykTesZF32EcSbElQcGGP9VJVscULcjjVIURIxewIfC/9vHfDigBd9w57xcbKlHyJ3ZE+tct7CaAliR/MYPnPPUkdAQEc5yUdt6PokDoRDu4rw3laAEv3Pxd2AT+MUzFdDSGsxdtq4=</li>
<li><em>In-reply-to</em>: &lt;b037451c0511151254q56fbddd1g758cebf6e5083058@mail.gmail.com&gt;</li>
<li><em>List-archive</em>: &lt;<a href="http://mail.pm.org/pipermail/omaha-pm">http://mail.pm.org/pipermail/omaha-pm</a>&gt;</li>
<li><em>List-help</em>: &lt;<a href="mailto:omaha-pm-request@pm.org?subject=help">mailto:omaha-pm-request@pm.org?subject=help</a>&gt;</li>
<li><em>List-id</em>: &quot;Perl Mongers of Omaha, Nebraska USA&quot; &lt;omaha-pm.pm.org&gt;</li>
<li><em>List-post</em>: &lt;<a href="mailto:omaha-pm@pm.org">mailto:omaha-pm@pm.org</a>&gt;</li>
<li><em>List-subscribe</em>: &lt;<a href="http://mail.pm.org/mailman/listinfo/omaha-pm">http://mail.pm.org/mailman/listinfo/omaha-pm</a>&gt;,	&lt;<a href="mailto:omaha-pm-request@pm.org?subject=subscribe">mailto:omaha-pm-request@pm.org?subject=subscribe</a>&gt;</li>
<li><em>List-unsubscribe</em>: &lt;<a href="http://mail.pm.org/mailman/listinfo/omaha-pm">http://mail.pm.org/mailman/listinfo/omaha-pm</a>&gt;,	&lt;<a href="mailto:omaha-pm-request@pm.org?subject=unsubscribe">mailto:omaha-pm-request@pm.org?subject=unsubscribe</a>&gt;</li>
<li><em>References</em>: &lt;<a href="msg00652.html">2379.68.13.86.85.1132076062.squirrel@mail.linder.org</a>&gt;	&lt;<a href="msg00653.html">b037451c0511151131q2679fb4x14946ab01dad22ff@mail.gmail.com</a>&gt;	&lt;<a href="msg00654.html">2384.68.13.86.85.1132083886.squirrel@mail.linder.org</a>&gt;	&lt;b037451c0511151254q56fbddd1g758cebf6e5083058@mail.gmail.com&gt;</li>
<li><em>Reply-to</em>: &quot;Perl Mongers of Omaha, Nebraska USA&quot; &lt;<a href="mailto:omaha-pm%40pm.org">omaha-pm@pm.org</a>&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>---------- Forwarded message ----------
From: Theodore Katseres &lt;tedkat@gmail.com&gt;
Date: Nov 15, 2005 2:54 PM
Subject: Re: [Omaha.pm] Perl and recursion...
To: dan@linder.org


Sorry, Your code was right!
The problem seems to be with while test. It keeps DIR descriptor open
thru the recursion. I think this is why it dives and then quits.

By loading up your files and directories into memory before recursion
you no longer depend on the File descriptor to keep its previous
state.

    opendir( DIR, $dir ) or die $!;
    my @arr = grep { !/^\.+$/ } readdir(DIR); ## just ignore . and ..
    close(DIR);

    while .....

On 11/15/05, Daniel Linder &lt;dan@linder.org&gt; wrote:
&gt; -----BEGIN PGP SIGNED MESSAGE----- Hash: SHA1
&gt;  On Tue, November 15, 2005 13:31, Theodore Katseres wrote:
&gt;  &gt; It appears that no recursion is happening passed the initial dive. {
&gt;  &gt; ProcFiles(&quot;/tmp&quot;) }
&gt;
&gt;  I agree -- when I take out the '&amp;ProcFiles(&quot;$dir/$file&quot;);' line, it
&gt; continues through the /tmp directory fine.  With the recursive call to
&gt; itself, I can watch the script dive into the sub-directory (/tmp/dir1), and
&gt; it processes all the files in /tmp/dir1, but when it finishes with the files
&gt; in &quot;dir1&quot; the program quits.  Unless I am missing something, I thought it
&gt; should go back one level to the initial invocation of ProcFiles and continue
&gt; where it left off there...
&gt;
&gt;  &gt; Check my comments.
&gt;  &gt;
&gt;  &gt; &lt;Snip &amp;&amp; Replace&gt;
&gt;  &gt; #!/bin/perl -w
&gt;  &gt; use strict;
&gt;  &gt;
&gt;  &gt; sub ProcFiles {
&gt;  &gt; my $dir = shift;
&gt;  &gt;
&gt;  &gt; opendir( DIR, $dir ) or die $!;
&gt;  &gt;
&gt;  &gt; while ( my $file = readdir(DIR) ) {
&gt;  &gt;
&gt;  &gt; next if ( -d &quot;$dir/$file&quot; &amp;&amp; $file =~ /^\./ );
&gt;  &gt;
&gt;  &gt; # above makes sure this block of code never gets executed
&gt;
&gt;  The line you mention (&quot;next if ...&quot;) is used to make sure I skip the &quot;.&quot;
&gt; and &quot;..&quot; entries in the subdirectory -- otherwise it would back out of the
&gt; &quot;/tmp&quot; to &quot;/&quot; and work there! :(  (It also has the effect of ignoring files
&gt; with a leading &quot;.&quot; -- that's also by design.)
&gt;
&gt;  &gt; if ( -d &quot;$dir/$file&quot; ) {
&gt;  &gt;
&gt;  &gt; printf( &quot;Diving into\&quot;%s/%s\&quot;.\n&quot;, $dir, $file );
&gt;  &gt;
&gt;  &gt; &amp;ProcFiles(&quot;$dir/$file&quot;);
&gt;  &gt;
&gt;  &gt; next;
&gt;  &gt;
&gt;  &gt; }
&gt;  &gt;
&gt;  &gt; # your printing files that don't begin with &quot;.&quot;
&gt;
&gt;  True -- in my real script, this print line is replaced with a small bit of
&gt; code to do some real work! In the example I posted to OLUG I wanted to keep
&gt; it simple and see if I could make it work...
&gt;
&gt;  &gt; printf( &quot;Adding\&quot;%s/%s\&quot;.\n&quot;, $dir, $file );
&gt;  &gt;
&gt;  &gt; }
&gt;  &gt;
&gt;  &gt; closedir(DIR);
&gt;  &gt;
&gt;  &gt; }
&gt;  &gt;
&gt;  &gt; &amp;ProcFiles(&quot;/tmp&quot;);
&gt;
&gt;  Ted, thanks for your input.
&gt;
&gt;  Dan
&gt;
&gt;  - - - - -
&gt;  &quot;Wait for that wisest of all counselors, time.&quot; -- Pericles
&gt;  &quot;I do not fear computer, I fear the lack of them.&quot; -- Isaac Asimov
&gt;  GPG fingerprint:6FFD DB94 7B96 0FD8 EADF 2EE0 B2B0 CC47 4FDE 9B68
&gt; -----BEGIN PGP SIGNATURE----- Version: GnuPG v1.4.1 (GNU/Linux)
&gt; iD8DBQFDejqusrDMR0/em2gRAtT2AJ9cL6zR+u/XpmGtjXNCCM/Y9WDcvwCfY1Fp
&gt; qXscyNVDA6vb5H8MuKUrEtM= =mFaZ -----END PGP SIGNATURE-----


--
Ted Katseres
      ||=O=||


--
Ted Katseres
      ||=O=||

</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00658" href="msg00658.html">Re: [Omaha.pm] Fwd:  Perl and recursion...</a></strong>
<ul><li><em>From:</em> &quot;Richard Norton&quot; &lt;ranorton@cox.net&gt;</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00652" href="msg00652.html">[Omaha.pm] Perl and recursion...</a></strong>
<ul><li><em>From:</em> &quot;Daniel Linder&quot; &lt;dan@linder.org&gt;</li></ul></li>
<li><strong><a name="00653" href="msg00653.html">Re: [Omaha.pm] Perl and recursion...</a></strong>
<ul><li><em>From:</em> Theodore Katseres &lt;tedkat@gmail.com&gt;</li></ul></li>
<li><strong><a name="00654" href="msg00654.html">Re: [Omaha.pm] Perl and recursion...</a></strong>
<ul><li><em>From:</em> &quot;Daniel Linder&quot; &lt;dan@linder.org&gt;</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg00656.html">Re: [Omaha.pm] Perl and recursion...</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg00658.html">Re: [Omaha.pm] Fwd:  Perl and recursion...</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg00656.html">Re: [Omaha.pm] Perl and recursion...</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00658.html">Re: [Omaha.pm] Fwd:  Perl and recursion...</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#00657"><strong>Date</strong></a></li>
<li><a href="threads.html#00657"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
</body>
</html>
